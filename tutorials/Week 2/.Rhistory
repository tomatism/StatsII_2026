setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
getwd()
library(readxls)
library(readxl)
data <- read_excel("cbg_turnover_v23upload.xls")
data <- read_excel("cbg_turnover_v23upload.xls")
data <- read_excel("cbg_turnover_v23upload.xls")
data <- read_excel("cbg_turnover_v23upload")
data <- read_excel("cbg_turnover_v23upload.xls")
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
getwd()
library(readxl)
data <- read_excel("cbg_turnover_v23upload.xls")
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
getwd()
library(readxl)
data <- read_excel("cbg_turnover_v23upload.xls")
data <- read_excel("cbg_turnover_v23upload.xlsx")
head(data)
rm(list=ls())
detachAllPackages <- function() {
basic.packages <- c("package:stats", "package:graphics", "package:grDevices", "package:utils", "package:datasets", "package:methods", "package:base")
package.list <- search()[ifelse(unlist(gregexpr("package:", search()))==1, TRUE, FALSE)]
package.list <- setdiff(package.list, basic.packages)
if (length(package.list)>0)  for (package in package.list) detach(package,  character.only=TRUE)
}
detachAllPackages()
pkgTest <- function(pkg){
new.pkg <- pkg[!(pkg %in% installed.packages()[,  "Package"])]
if (length(new.pkg))
install.packages(new.pkg,  dependencies = TRUE)
sapply(pkg,  require,  character.only = TRUE)
}
lapply(c("tidyverse", "ggplot2", "readxl"),
pkgTest)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
getwd()
data_raw <- read_excel("cbg_turnover_v23upload.xlsx")
head(data)
data <- data_raw |>
select(codewdi, country, year, `time to regular turnover`,
`irregular turnover dummy`, `legal duration`) |>
mutate(
codewdi = as.factor(codewdi),
country = as.factor(country),
year = as.integer(year),
time_to_regular_turnover = as.integer(`time to regular turnover`),
irregular_turnover_dummy = as.integer(`irregular turnover dummy`),
`legal duration` = as.integer(`legal duration`)
)
data <- data_raw |>
select(codewdi, country, year, `time to regular turnover`,
`irregular turnover dummy`, `legal duration`) |>
mutate(
codewdi = as.factor(codewdi),
country = as.factor(country),
year = as.integer(year),
time_to_regular_turnover = as.integer(`time to regular turnover`),
irregular_turnover_dummy = as.integer(`irregular turnover dummy`),
`legal duration` = as.integer(`legal duration`)
) |>
drop_na()
warnings()
data <- data_raw |>
select(codewdi, country, year, `time to regular turnover`,
`irregular turnover dummy`, `legal duration`) |>
mutate(
codewdi = as.factor(codewdi),
country = as.factor(country),
year = as.integer(year),
time_to_regular_turnover = as.integer(`time to regular turnover`),
irregular_turnover_dummy = as.integer(`irregular turnover dummy`),
legal_duration = as.integer(`legal duration`)
) |>
drop_na()
View(data)
data <- data_raw |>
select(codewdi, country, year, `time to regular turnover`,
`irregular turnover dummy`, `legal duration`) |>
mutate(
codewdi = as.factor(codewdi),
country = as.factor(country),
year = as.integer(year),
time_to_regular_turnover = as.integer(`time to regular turnover`),
irregular_turnover_dummy = as.integer(`irregular turnover dummy`),
legal_duration = as.integer(`legal duration`)
) |>
drop_na() |>
select(codewdi, country, year, time_to_regular_turnover,
irregular_turnover_dummy, legal_duration)
View(data)
data <- data_raw |>
select(codewdi, country, year, `time to regular turnover`,
`irregular turnover dummy`, `legal duration`, `regular turnover dummy`) |>
mutate(
codewdi = as.factor(codewdi),
country = as.factor(country),
year = as.integer(year),
time_to_regular_turnover = as.integer(`time to regular turnover`),
irregular_turnover_dummy = as.integer(`irregular turnover dummy`),
legal_duration = as.integer(`legal duration`),
regular_turnover_dummy = as.integer(`regular turnover dummy`)
) |>
drop_na() |>
select(codewdi, country, year, time_to_regular_turnover,
irregular_turnover_dummy, legal_duration, regular_turnover_dummy)
data <- data |>
mutate(
across(
c(year, time_to_regular_turnover, irregular_turnover_dummy, regular_turnover_dummy,
legal_duration)
),
-replace(.,. %in% bad_code, NA)
)
data <- data |>
mutate(
across(
c(year, time_to_regular_turnover, irregular_turnover_dummy, regular_turnover_dummy,
legal_duration)
),
-replace(., . %in% bad_code, NA)
)
data <- data |>
mutate(
across(
c(
year,
time_to_regular_turnover,
irregular_turnover_dummy,
regular_turnover_dummy,
legal_duration
),
~ replace(.x, .x %in% bad_code, NA)
)
)
bad_code <- c(-999, -666, -555, -881)
data <- data |>
mutate(
across(
c(
year,
time_to_regular_turnover,
irregular_turnover_dummy,
regular_turnover_dummy,
legal_duration
),
~ replace(.x, .x %in% bad_code, NA)
)
)
unique(year)
unique(data$year)
data <- data |>
mutate(
across(
c(
year,
time_to_regular_turnover,
irregular_turnover_dummy,
regular_turnover_dummy,
legal_duration
),
~ replace(.x, .x %in% bad_code, NA)
)
) |>
drop_na()
country_turnover <- data %>%
group_by(country) %>%
summarize(
avg_turnover = mean(irregular_turnover),
n = n()
)
country_turnover <- data %>%
group_by(country) %>%
summarize(
avg_turnover = mean(irregular_turnover_dummy),
n = n()
)
View(country_turnover)
country_turnover %>%
arrange(desc(avg_turnover)) %>%
slice(1:5)
country_turnover %>%
arrange(avg_turnover) %>%
slice(1:5)
country_turnover |>
ggplot(x = avg_turnover) |>
geom_histogram()
country_turnover |>
ggplot(x = avg_turnover) +
geom_histogram()
View(country_turnover)
country_turnover |>
ggplot(aes(x = avg_turnover)) +
geom_histogram()
modela <- lm(
irregular_turnover ~ time_to_regular_turnover + legal_duration,
data = data
)
modela <- lm(
irregular_turnover_dummy ~ time_to_regular_turnover + legal_duration,
data = data
)
summary(modela)
typical <- data.frame(
time_to_regular_turnover = median(data$time_to_regular_turnover, na.rm = TRUE),
legal_duration = median(data$legal_duration, na.rm = TRUE)
)
predicta <- predict(modela, newdate = typical)
data$lpm_pred <- predict(modela)
data$modela_pred <- predict(modela)
data %>%
filter(modela_pred < 0 | modela_pred > 1) %>%
select(country, year, modela_pred) %>%
head()
grid <- data.frame(
time_to_regular_turnover = seq(
min(data$time_to_regular_turnover, na.rm = TRUE),
max(data$time_to_regular_turnover, na.rm = TRUE),
length.out = 100
),
legal_duration = median(data$legal_duration, na.rm = TRUE)
)
grid$lpm_fit <- predict(modela, newdata = grid)
library(ggplot2)
ggplot(grid, aes(x = time_to_regular_turnover, y = lpm_fit)) +
geom_line(color = "blue", linewidth = 1) +
labs(
x = "Time to Regular Turnover",
y = "Predicted Probability of Irregular Turnover",
title = "LPM Predicted Probability"
)
logit <- glm(
irregular_turnover ~ time_to_regular_turnover + legal_duration,
data = data,
family = binomial
)
logit <- glm(
irregular_turnover_dummy ~ time_to_regular_turnover + legal_duration,
data = data,
family = binomial
)
summary(logit)
